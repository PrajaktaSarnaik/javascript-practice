<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Login/Register Modal</title>
    <link href="https://stackpath.bootstrapcdn.com/bootstrap/5.3.0/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
     <!-- Trigger Button -->
     <div class="container mt-5 text-center">
        <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#loginModal">Login</button>
    </div>
    <!-- Login Modal -->
    <div class="modal fade" id="loginModal" tabindex="-1" aria-labelledby="loginModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="loginModalLabel">Login</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="loginForm">
                        <div class="mb-3">
                            <label for="loginUsername" class="form-label">Username</label>
                            <input type="text" class="form-control" id="loginUsername" required>
                        </div>
                        <div class="mb-3">
                            <label for="loginPassword" class="form-label">Password</label>
                            <input type="password" class="form-control" id="loginPassword" required>
                        </div>
                        <button type="submit" class="btn btn-primary">Login</button>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-toggle="modal" data-bs-target="#registerModal">Register</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Register Modal -->
    <div class="modal fade" id="registerModal" tabindex="-1" aria-labelledby="registerModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="registerModalLabel">Register</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="registerForm">
                        <div class="mb-3">
                            <label for="registerUsername" class="form-label">Username</label>
                            <input type="text" class="form-control" id="registerUsername" required>
                        </div>
                        <div class="mb-3">
                            <label for="registerPassword" class="form-label">Password</label>
                            <input type="password" class="form-control" id="registerPassword" required>
                        </div>
                        <button type="submit" class="btn btn-primary">Register</button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/5.3.0/js/bootstrap.bundle.min.js"></script>
    <script src="login_register_modal.js"></script>
    <script>
                          $(document).ready(function() {
                const usersFile = 'users.txt';
            
                function readUsersFile(callback) {
                    $.ajax({
                        url: usersFile,
                        method: 'GET',
                        success: function(data) {
                            const users = data.trim().split('\n').map(line => line.split(','));
                            callback(users);
                        },
                        error: function() {
                            callback([]);
                        }
                    });
                }
            
                function writeUsersFile(data, callback) {
                    const blob = new Blob([data], { type: 'text/plain' });
                    const url = URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = usersFile;
                    document.body.appendChild(a);
                    a.click();
                    document.body.removeChild(a);
                    URL.revokeObjectURL(url);
                    callback();
                }
            
                $('#loginForm').on('submit', function(event) {
                    event.preventDefault();
                    const username = $('#loginUsername').val();
                    const password = $('#loginPassword').val();
            
                    readUsersFile(function(users) {
                        const user = users.find(user => user[0] === username && user[1] === password);
                        if (user) {
                            alert('Login successful');
                        } else {
                            alert('Invalid username or password');
                        }
                    });
                });
            
                $('#registerForm').on('submit', function(event) {
                    event.preventDefault();
                    const username = $('#registerUsername').val();
                    const password = $('#registerPassword').val();
            
                    readUsersFile(function(users) {
                        const userExists = users.some(user => user[0] === username);
                        if (userExists) {
                            alert('Username already exists');
                        } else {
                            users.push([username, password]);
                            const data = users.map(user => user.join(',')).join('\n');
                            writeUsersFile(data, function() {
                                alert('Registration successful');
                            });
                        }
                    });
                });
            });
    </script>
</body>
</html>